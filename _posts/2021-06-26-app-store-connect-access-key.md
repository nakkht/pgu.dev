---
layout: post
title: "iOS: using App Store Connect API in fastlane"
author: Paulius Gudonis
---

Back in 2018 Apple introduced App Store Connect API and with that came App Store Connect API Keys. These keys essentially are combination of private key and some meta information, such as key id and issue id, which is normally used together. By simply visiting [App Store Connect: Users and Access](https://appstoreconnect.apple.com/access/api) you can generate keys right away. However, the limit as of now is 50 (you can of course revoke keys at any time later and generate new ones) and furthermore, only accounts with Admin role can generate keys.

The same way your personal account has a role in App Store Connect, API keys have it too. These roles determine which API endpoints will be accessible. Further information about roles can be found on [Apple's help page](https://help.apple.com/app-store-connect/#/deve5f9a89d7)

Since 2021 March Apple requires two-factor authentication for developer program accounts to sign in to their Apple Developer account. This brings more hassle to automate tasks such as deploying release app to App Store, generating and accessing certificates/profiles, inviting people to TestFlight, reporting, etc. So if you did not migrate already to API keys, it is about time.

To start with, key has to be generated. For simple app upload to the App Store connect, roles such as `App Manager` or `Developer` should suffice.

> **Note**: An API key's access cannot be limited to specific apps.

After creating a key, you will have a chance to download it once. So if you loose it, you will have to revoke it and generate a new one. Downloaded key content will look like this:

```
-----BEGIN PRIVATE KEY-----
MIGTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBHkwdwIBAQQgx/elP2iGhBcUtD2B
I4AcMkR7x6YsoqwQu/1rdV4J+QmgCgYIKoZIzj0DAQehRANCAAQP/zl0hkl45Lri
eQnfJ+c+wLGGfd7ovYPoxR6ce3L3wwVKo/gmxLLVQdQEeacYW0PPPsvcKUUzxWtm
hPRRCDBE
-----END PRIVATE KEY-----
```

As it says, it is a private key, so keep it safe. The part between the `-----BEGIN PRIVATE KEY-----` and `-----END PRIVATE KEY-----` is a `base64` formatted `ASN.1 PKCS#8` representation of the key itself.

Since we have all the API key material (you should also see `KEY ID` next to `GENERATED BY` column and `Issuer ID` just above `Active` key list), let's add those to fastlane.